# Default values for veritas-spark

replicaCount: 1

image:
  repository: veritas-spark
  tag: "0.5.0"
  pullPolicy: IfNotPresent

serviceAccount:
  create: true
  name: ""

resources:
  requests:
    memory: "2Gi"
    cpu: "1"
  limits:
    memory: "4Gi"
    cpu: "2"

# GPU configuration (optional)
gpu:
  enabled: false
  count: 1
  resourceType: "nvidia.com/gpu"

# Model storage
models:
  pvcName: "models-pvc"
  mountPath: "/models"

# Runtime configuration
config:
  socketPath: "/var/run/veritas/veritas-spark.sock"
  maxContextLength: 4096
  sessionTimeout: 3600
  shutdownTimeout: 30

# Health probes using exec (NO HTTP)
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  readOnlyRootFilesystem: true

# Pod security
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# Network policy (deny all by default - Alcatraz principle)
networkPolicy:
  enabled: true
  denyAll: true

nodeSelector: {}

tolerations: []

affinity: {}

# =============================================================================
# ADVANCED DEPLOYMENT STRATEGIES
# =============================================================================

# Canary deployment configuration
# Enable this to use canary deployments with traffic splitting
canary:
  enabled: false
  # Stable deployment settings
  stable:
    version: "" # defaults to image.tag
    replicas: 3
  # Canary deployment settings
  canary:
    version: "" # required when canary.enabled is true
    replicas: 1
  # Traffic weight (0-100) percentage to canary
  trafficWeight: 0
  # Analysis configuration for auto-promotion/rollback
  analysis:
    # Metrics thresholds
    metrics:
      - name: error-rate
        threshold: "0.01" # 1% max error rate
        operator: LessThan
      - name: p99-latency
        threshold: "500ms"
        operator: LessThan
    # Analysis interval
    interval: "1m"
    # Number of failed analyses before rollback
    failureLimit: 3
    # Number of successful analyses before promotion
    successLimit: 3
  # Promotion settings
  promotion:
    auto: false
    # Traffic weight progression steps
    steps:
      - weight: 10
        pause: "5m"
      - weight: 25
        pause: "5m"
      - weight: 50
        pause: "10m"
      - weight: 75
        pause: "10m"
      - weight: 100
  # Rollback settings
  rollback:
    auto: true
    preserveCanary: false
  # Pod disruption budget
  pdb:
    minAvailable: 1

# Blue-Green deployment configuration
# Enable this to use blue-green deployments with atomic traffic switching
bluegreen:
  enabled: false
  # Active environment (blue or green)
  active: blue
  # Blue environment settings
  blue:
    version: "" # required when bluegreen.enabled is true
    replicas: 3
    # Optional resource overrides
    resources: {}
  # Green environment settings
  green:
    version: "" # required when bluegreen.enabled is true
    replicas: 3
    # Optional resource overrides
    resources: {}
  # Preview service for testing inactive environment
  preview:
    enabled: true
  # Traffic switch mode
  switch:
    mode: instant # instant or gradual
    # Gradual switch steps (only used when mode is gradual)
    gradualSteps:
      - weight: 25
        duration: "5m"
      - weight: 50
        duration: "5m"
      - weight: 75
        duration: "5m"
      - weight: 100
    # Health check before completing switch
    healthCheck:
      enabled: true
      timeout: "2m"
      minReadySeconds: 30
  # Scale down inactive environment
  scaleDown:
    enabled: false
    delay: "30m"
    minReplicas: 1
  # Pod disruption budget
  pdb:
    minAvailable: 1

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Monitoring configuration for Grafana dashboards and Prometheus alerts
monitoring:
  # Grafana dashboard configuration
  grafana:
    dashboard:
      # Enable Grafana dashboard ConfigMap
      enabled: true
      # Dashboard labels for Grafana sidecar discovery
      labels:
        grafana_dashboard: "1"
      # Additional annotations
      annotations: {}

  # Prometheus alert rules configuration
  prometheus:
    rules:
      # Enable PrometheusRule resource
      enabled: true
      # Additional labels for PrometheusRule
      additionalLabels:
        release: prometheus
      # Rule namespace (defaults to release namespace)
      namespace: ""

  # ServiceMonitor for Prometheus scraping (requires Prometheus Operator)
  serviceMonitor:
    enabled: false
    # Interval for scraping metrics
    interval: "30s"
    # Path to metrics endpoint (if exposed)
    path: "/metrics"
    # Additional labels for ServiceMonitor
    additionalLabels: {}
